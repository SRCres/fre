<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>fre &raquo; examples</title>
</head>
<body onload="main()">
<canvas id="example" width="800" height="600"></canvas>
<script type="text/javascript" src="../dist/fre.js"></script>
<script type="text/javascript">
function main() {
  var shaderSources = [];

  fre.ajax('shaders/point.vert', onLoadVert, null, onError);
  fre.ajax('shaders/point.frag', onLoadFrag, null, onError);

  function onLoadVert(evt, xhr) {
    shaderSources[0] = xhr.response;
    loaded();
  }

  function onLoadFrag(evt, xhr) {
    shaderSources[1] = xhr.response;
    loaded();
  }

  function onError(evt) {
    console.log(evt);
  }

  function loaded() {
    if (shaderSources.length === 2) {
      initialize(shaderSources);
    }
  }
}

function initialize(shaderSources) {
  var canvas = document.getElementById('example'),
      gl = fre.gl.getWebGLContext(canvas);

  if (!gl) {
    console.log('No se pudo obtener el contexto de renderizado para WebGL.');
    return;
  }

  var program = new fre.gl.Program(shaderSources);

  var points = [
    0.0, 0.5,
    -0.5, -0.5,
    0.5, -0.5
  ];
  var TypedArray = fre.gl.Variable.getTypedArrayByType(program.attributes.a_Position.type);
  if (TypedArray) {
    points = new TypedArray(points);
  }

  var buffer = new fre.gl.Buffer(gl.ARRAY_BUFFER, points, gl.STATIC_DRAW);

  var data = {
    a_Position: {
      buffer: buffer,
      numComponents: 2
    },
    u_FragColor: [1.0, 1.0, 0.0, 1.0]
  };

  program.attributes.setCollection(data);

  gl.useProgram(program.webGLProgram);

  program.uniforms.setCollection(data);

  gl.clearColor(0.0, 0.0, 0.0, 1.0);
  gl.clear(gl.COLOR_BUFFER_BIT);

  gl.drawArrays(gl.TRIANGLE_STRIP, 0, points.length / data.a_Position.numComponents);
}
</script>
</body>
</html>